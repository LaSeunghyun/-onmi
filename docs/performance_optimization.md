<!-- 성능 최적화 요약 문서 -->

# 성능 최적화 개요

상세 페이지 진입 지연을 최소화하기 위해 프론트엔드와 백엔드 전반에 걸쳐 다음과 같은 개선을 적용했습니다.

- **플러터 클라이언트**
  - `PerformanceMonitor` 유틸로 네트워크/빌드 구간을 계측하고 Timeline 이벤트를 기록합니다.
  - 요약 데이터는 Hive 캐시에 저장하여 재방문 시 즉시 표시합니다.
  - 요약 카드와 상세 화면에 스켈레톤 UI를 도입하고, 900ms 이상 로딩 시 자동으로 전환됩니다.

- **FastAPI 게이트웨이**
  - `utils.performance` 모듈의 컨텍스트 매니저를 이용해 주요 DB/서비스 호출 시간을 기록합니다.
  - 요약 라우터는 날짜 목록 조회와 요약 조회를 병렬 실행하고, 기사 개수는 경량화된 `COUNT` 쿼리로 대체합니다.
  - `SummaryService`는 기사 조회와 피드백 집계를 동시에 수행하고, 토큰 사용량 기록을 비동기로 처리합니다.

## 계측 로그 확인 방법

### Flutter
- 디버그 빌드에서 디버그 콘솔 또는 DevTools의 Timeline에서 `PerformanceMonitor` 이벤트를 확인할 수 있습니다.
- 각 로깅 항목에는 라벨과 필요한 메타데이터(요약 날짜, 키워드 ID 등)가 포함됩니다.

### FastAPI
- `backend/api-gateway/logs/api-gateway.log` 파일에 `[PERF][START|END]` 로그가 기록됩니다.
- 임계치(기본 200ms)를 초과하는 구간은 `WARNING` 레벨로 분류되어 병목을 쉽게 식별할 수 있습니다.

## 스켈레톤 UI 노출 조건

| 영역 | 조건 | 전환 시점 |
| --- | --- | --- |
| 요약 카드 | 캐시된 요약이 없고 API 응답이 900ms 이상 지연 | 로딩 상태가 유지되면 자동 전환 |
| 기사 목록 | `FeedNotifier`가 로딩 중일 때 | 즉시 |

## 병렬 처리 흐름

### `/summaries/daily`
1. 날짜 목록과 최신 요약을 동시에 조회합니다.
2. 요약이 이미 존재하면 기사 개수만 `COUNT` 쿼리로 계산합니다.
3. 요약이 없으면 `SummaryService.generate_daily_summary` 를 호출하고, 생성된 날짜를 즉시 리스트에 반영합니다.

### `SummaryService.generate_*`
1. 기사 목록과 피드백 통계를 `asyncio.gather`로 병렬 실행합니다.
2. Gemini 요약 생성 후 토큰 사용량 기록은 백그라운드 태스크로 수행합니다.
3. 요약 세션 저장 완료 후 토큰 기록 태스크의 종료를 기다립니다.

## 향후 확장 포인트

- 캐시 무효화를 위한 TTL 정책 적용
- 스켈레톤 UI의 애니메이션 세분화 (예: 기사 리스트별 커스텀 플레이스홀더)
- FastAPI 응답에 서버 처리 시간을 포함하는 헤더(`X-Process-Time`) 추가


